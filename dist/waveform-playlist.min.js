/*! waveform-playlist 0.1.0
Written by: Naomi Aro
Website: http://naomiaro.github.io/waveform-playlist
License: MIT */
function makePublisher(a){var b;for(b in publisher)publisher.hasOwnProperty(b)&&"function"==typeof publisher[b]&&(a[b]=publisher[b]);a.subscribers={any:[]}}var publisher={subscribers:{any:[]},on:function(a,b,c){a=a||"any",b="function"==typeof b?b:c[b],"undefined"==typeof this.subscribers[a]&&(this.subscribers[a]=[]),this.subscribers[a].push({fn:b,context:c||this})},remove:function(a,b,c){this.visitSubscribers("unsubscribe",a,b,c)},fire:function(a,b){this.visitSubscribers("publish",a,b)},reset:function(a){this.subscribers[a]=void 0},visitSubscribers:function(a,b,c,d){var e,f=b||"any",g=this.subscribers[f],h=g?g.length:0;for(e=0;h>e;e+=1)"publish"===a?g[e].fn.call(g[e].context,c):g[e].fn===c&&g[e].context===d&&g.splice(e,1)}},Storage=function(){};Storage.prototype.save=function(a,b){var c=JSON.stringify(b);console.log(c),localStorage.setItem(a,c)},Storage.prototype.restore=function(a){var b,c=localStorage.getItem(a);return console.log(c),b=JSON.parse(c)};var Config=function(a){var b,c=this;b={ac:new(window.AudioContext||window.webkitAudioContext),resolution:4096,minResolution:500,maxResolution:2e4,timeFormat:"hh:mm:ss.uu",mono:!0,fadeType:"logarithmic",timescale:!1,UITheme:"default",waveColor:"grey",progressColor:"orange",loadingColor:"purple",cursorColor:"green",markerColor:"green",selectBorderColor:"red",selectBackgroundColor:"rgba(0,0,0,0.1)",timeColor:"grey",fontColor:"black",fadeColor:"black",waveHeight:128,trackscroll:{left:0,top:0},state:"select",cursorPos:0},a=Object.create(a),Object.keys(b).forEach(function(c){c in a||(a[c]=b[c])}),c.getContainer=function(){return a.container},c.isTimeScaleEnabled=function(){return a.timescale},c.getFadeType=function(){return a.fadeType},c.isDisplayMono=function(){return a.mono},c.getUITheme=function(){return a.UITheme},c.getCursorPos=function(){return a.cursorPos},c.getState=function(){return a.state},c.getAudioContext=function(){return a.ac},c.getSampleRate=function(){return a.ac.sampleRate},c.getCurrentTime=function(){return a.ac.currentTime},c.getTimeFormat=function(){return a.timeFormat},c.getMinResolution=function(){return a.minResolution},c.getMaxResolution=function(){return a.maxResolution},c.getResolution=function(){return a.resolution},c.getWaveHeight=function(){return a.waveHeight},c.getColorScheme=function(){return{waveColor:a.waveColor,progressColor:a.progressColor,loadingColor:a.loadingColor,cursorColor:a.cursorColor,markerColor:a.markerColor,timeColor:a.timeColor,fontColor:a.fontColor,fadeColor:a.fadeColor,selectBorderColor:a.selectBorderColor,selectBackgroundColor:a.selectBackgroundColor}},c.getTrackScroll=function(){var b=a.trackscroll;return{left:b.left,top:b.top}},c.setResolution=function(b){a.resolution=b},c.setTimeFormat=function(b){a.timeFormat=b},c.setFadeType=function(b){a.fadeType=b},c.setDisplayMono=function(b){a.mono=b},c.setCursorPos=function(b){a.cursorPos=b},c.setState=function(b){a.state=b},c.setTrackScroll=function(b,c){var d=a.trackscroll;d.left=void 0!==b?b:d.left,d.top=void 0!==c?c:d.top}},Curves={};Curves.createLinearBuffer=function(a,b){var c,d,e=new Float32Array(a),f=a-1;for(c=0;a>c;c++)d=c/f,b>0?e[c]=d:e[c]=1-d;return e},Curves.createExponentialBuffer=function(a,b){var c,d,e,f=new Float32Array(a),g=a-1;for(c=0;a>c;c++)d=c/g,e=b>0?c:a-1-c,f[e]=Math.exp(2*d-1)/Math.exp(1);return f},Curves.createSCurveBuffer=function(a,b){var c,d=new Float32Array(a);for(c=0;a>c;++c)d[c]=Math.sin(Math.PI*c/a-b)/2+.5;return d},Curves.createLogarithmicBuffer=function(a,b,c){var d,e,f=new Float32Array(a),g=""+a+b+c,h=[],i=0;if(h[g])return h[g];for(e=0;a>e;e++)d=c>0?e:a-1-e,i=e/a,f[d]=Math.log(1+b*i)/Math.log(1+b);return h[g]=f,f};var WaveformDrawer=function(){};WaveformDrawer.prototype.init=function(a,b){makePublisher(this),this.config=b,this.container=a,this.channels=[],this.pixelOffset=0;var c=this.config.getUITheme();void 0!==this.loaderStates[c]?this.loaderStates=this.loaderStates[c]:this.loaderStates=this.loaderStates["default"]},WaveformDrawer.prototype.loaderStates={bootstrap:{downloading:"progress-bar",decoding:"progress-bar progress-bar-striped",loader:"bar"},jQueryUI:{downloading:"ui-progressbar ui-widget ui-widget-content ui-corner-all",decoding:"ui-progressbar ui-widget ui-widget-content ui-corner-all",loader:"ui-progressbar-value ui-widget-header ui-corner-left"},"default":{downloading:"progress",decoding:"decoding",loader:"bar"}},WaveformDrawer.prototype.getPeaks=function(a,b){var c,d,e,f,g,h,i,j,k,l,m=this.config.getResolution(),n=[],o=b.cueout-b.cuein,p=Math.ceil(o/m),q=a.numberOfChannels,r=1/q,s=this.config.isDisplayMono(),t=-(1/0);for(c=0;p>c;c++){for(n[c]=[],d=0;q>d;d++){for(g=a.getChannelData(d),g=g.subarray(b.cuein,b.cueout),h=c*m,i=(c+1)*m>o?o:(c+1)*m,j=g.subarray(h,i),k=-(1/0),l=1/0,e=0,f=j.length;f>e;e++)j[e]>k&&(k=j[e]),j[e]<l&&(l=j[e]);n[c].push({max:k,min:l}),t=Math.max.apply(Math,[t,Math.abs(k),Math.abs(l)])}if(s){for(k=l=0,d=0;q>d;d++)k+=r*n[c][d].max,l+=r*n[c][d].min;n[c]=[],n[c].push({max:k,min:l})}}this.maxPeak=t,this.peaks=n},WaveformDrawer.prototype.setPixelOffset=function(a){this.pixelOffset=a,this.drawTimeShift()},WaveformDrawer.prototype.drawTimeShift=function(){var a,b;for(a=0,b=this.channels.length;b>a;a++)this.channels[a].div.style.left=this.pixelOffset+"px"},WaveformDrawer.prototype.updateLoader=function(a){this.loader.style.width=a+"%"},WaveformDrawer.prototype.setLoaderState=function(a){this.loader.className=this.loaderStates[a]},WaveformDrawer.prototype.drawLoading=function(){var a,b;this.height=this.config.getWaveHeight(),a=document.createElement("div"),a.style.height=this.height+"px",b=document.createElement("div"),b.style.height="10px",b.className=this.loaderStates.loader,a.appendChild(b),this.loader=b,this.setLoaderState("downloading"),this.updateLoader(0),this.container.appendChild(a)},WaveformDrawer.prototype.drawBuffer=function(a,b){var c,d,e,f,g,h,i,j=0,k=0,l=this.config.isDisplayMono(),m=this.config.getResolution(),n=l?1:a.numberOfChannels,o=b.cueout-b.cuein+1,p=document.createDocumentFragment(),q=this.config.getColorScheme();for(this.container.innerHTML="",this.channels=[],this.width=Math.ceil(o/m),this.height=this.config.getWaveHeight(),h=0;n>h;h++)d=document.createElement("div"),d.classList.add("channel"),d.classList.add("channel-"+h),d.style.width=this.width+"px",d.style.height=this.height+"px",d.style.top=j+"px",d.style.left=k+"px",d.style.background=q.waveColor,c=document.createElement("canvas"),c.setAttribute("width",this.width),c.setAttribute("height",this.height),e=document.createElement("div"),e.classList.add("channel-progress"),e.style.background=q.progressColor,e.style.width=0,e.style.height=this.height+"px",g=document.createElement("canvas"),g.setAttribute("width",this.width),g.setAttribute("height",this.height),this.channels.push({context:c.getContext("2d"),div:d,progress:e,surface:g.getContext("2d")}),d.appendChild(c),d.appendChild(e),d.appendChild(g),p.appendChild(d),j+=this.height;f=document.createElement("div"),f.classList.add("cursor"),f.style.position="absolute",f.style.top=0,f.style.left=0,f.style.bottom=0,f.style.borderRight="1px solid #000",this.cursor=f,p.appendChild(f),i=n*this.height,this.container.style.height=i+"px",this.container.appendChild(p),this.getPeaks(a,b),this.draw(),this.drawTimeShift()},WaveformDrawer.prototype.drawFrame=function(a,b,c){{var d,e,f,g,h=this.height/2,i=this.channels[a].context;this.config.getColorScheme()}f=Math.abs(c.max/this.maxPeak*h),g=Math.abs(c.min/this.maxPeak*h),e=1,d=b*e,i.fillStyle="white",i.fillRect(d,0,e,h-f),i.fillRect(d,h+g,e,h-g)},WaveformDrawer.prototype.draw=function(a,b){var c=this,d=this.peaks,e=this.pixelOffset,f=a?a-e:0,g=b?b-e+1:d.length;if(!(0>f&&0>g))for(0>f&&(f=0),g>d.length&&(g=d.length);g>f;f++)d[f].forEach(function(a,b){c.drawFrame(b,f,a)})},WaveformDrawer.prototype.clear=function(){var a,b;for(a=0,b=this.channels.length;b>a;a++)this.channels[a].surface.clearRect(0,0,this.width,this.height)},WaveformDrawer.prototype.updateProgress=function(a){this.drawProgress(a),this.drawCursor(a)},WaveformDrawer.prototype.drawProgress=function(a){var b,c,d=Math.max(a-this.pixelOffset,0),e=Math.min(d,this.width);for(b=0,c=this.channels.length;c>b;b++)this.channels[b].progress.style.width=e+"px"},WaveformDrawer.prototype.drawCursor=function(a){this.cursor.style.width=a+"px"},WaveformDrawer.prototype.drawHighlight=function(a,b){var c,d,e,f,g=this.config.getColorScheme(),h=b-a+1;for(e=1===h?g.selectBorderColor:g.selectBackgroundColor,this.clear(),c=0,d=this.channels.length;d>c;c++)f=this.channels[c].surface,f.fillStyle=e,f.fillRect(a,0,h,this.height)},WaveformDrawer.prototype.sCurveFadeIn=function(a,b){return Curves.createSCurveBuffer(b,Math.PI/2)},WaveformDrawer.prototype.sCurveFadeOut=function(a,b){return Curves.createSCurveBuffer(b,-(Math.PI/2))},WaveformDrawer.prototype.logarithmicFadeIn=function(a,b){return Curves.createLogarithmicBuffer(b,10,1)},WaveformDrawer.prototype.logarithmicFadeOut=function(a,b){return Curves.createLogarithmicBuffer(b,10,-1)},WaveformDrawer.prototype.exponentialFadeIn=function(a,b){return Curves.createExponentialBuffer(b,1)},WaveformDrawer.prototype.exponentialFadeOut=function(a,b){return Curves.createExponentialBuffer(b,-1)},WaveformDrawer.prototype.linearFadeIn=function(a,b){return Curves.createLinearBuffer(b,1)},WaveformDrawer.prototype.linearFadeOut=function(a,b){return Curves.createLinearBuffer(b,-1)},WaveformDrawer.prototype.drawFadeCurve=function(a,b,c,d){var e,f,g,h,i=b+c,j=this[i],k=this.config.getColorScheme(),l=this.height;for(a.strokeStyle=k.fadeColor,e=j.call(this,a,d),h=l-e[0]*l,a.beginPath(),a.moveTo(0,h),f=1,g=e.length;g>f;f++)h=l-e[f]*l,a.lineTo(f,h);a.stroke()},WaveformDrawer.prototype.removeFade=function(a){var b,c,d,e,f="playlist-fade-"+a;if(c=this.container.getElementsByClassName(f),e=c.length,e>0)for(d=e-1;d>=0;d--)b=c[d],b.parentNode.removeChild(b)},WaveformDrawer.prototype.drawFade=function(a,b,c,d,e){var f,g,h,i,j,k,l,m,n,o=document.createDocumentFragment();if(e-d!==0)for(h=~~(e-d+1),i=d,f=document.createElement("div"),f.classList.add("playlist-fade"),f.classList.add("playlist-fade-"+a),f.style.width=h+"px",f.style.height=this.height+"px",f.style.top=0,f.style.left=i+"px",g=document.createElement("canvas"),g.setAttribute("width",h),g.setAttribute("height",this.height),m=g.getContext("2d"),this.drawFadeCurve(m,c,b,h),f.appendChild(g),o.appendChild(f),j=0,k=this.channels.length;k>j;j++)l=o.cloneNode(!0),n=l.querySelector("canvas").getContext("2d"),n.drawImage(g,0,0),this.channels[j].div.appendChild(l)},WaveformDrawer.prototype.drawFades=function(a){var b,c,d,e,f=this.config.getSampleRate(),g=this.config.getResolution();for(b in a)c=a[b],a.hasOwnProperty(b)&&(d=c.start*f/g,e=c.end*f/g,this.drawFade(b,c.type,c.shape,d,e))};var Fades=function(){};Fades.prototype.init=function(a){this.sampleRate=a},Fades.prototype.sCurveFadeIn=function(a,b,c,d){var e;e=Curves.createSCurveBuffer(this.sampleRate,Math.PI/2),a.setValueCurveAtTime(e,b,c)},Fades.prototype.sCurveFadeOut=function(a,b,c,d){var e;e=Curves.createSCurveBuffer(this.sampleRate,-(Math.PI/2)),a.setValueCurveAtTime(e,b,c)},Fades.prototype.linearFadeIn=function(a,b,c,d){a.linearRampToValueAtTime(0,b),a.linearRampToValueAtTime(1,b+c)},Fades.prototype.linearFadeOut=function(a,b,c,d){a.linearRampToValueAtTime(1,b),a.linearRampToValueAtTime(0,b+c)},Fades.prototype.exponentialFadeIn=function(a,b,c,d){a.exponentialRampToValueAtTime(.01,b),a.exponentialRampToValueAtTime(1,b+c)},Fades.prototype.exponentialFadeOut=function(a,b,c,d){a.exponentialRampToValueAtTime(1,b),a.exponentialRampToValueAtTime(.01,b+c)},Fades.prototype.logarithmicFadeIn=function(a,b,c,d){var e,f=d.base;f="undefined"!=typeof f?f:10,e=Curves.createLogarithmicBuffer(this.sampleRate,f,1),a.setValueCurveAtTime(e,b,c)},Fades.prototype.logarithmicFadeOut=function(a,b,c,d){var e,f=d.base;f="undefined"!=typeof f?f:10,e=Curves.createLogarithmicBuffer(this.sampleRate,f,-1),a.setValueCurveAtTime(e,b,c)},Fades.prototype.createFadeIn=function(a,b,c){var d=b+"FadeIn",e=this[d];e.call(this,a,c.start,c.duration,c)},Fades.prototype.createFadeOut=function(a,b,c){var d=b+"FadeOut",e=this[d];e.call(this,a,c.start,c.duration,c)};var AudioPlayout=function(){};AudioPlayout.prototype.init=function(a){makePublisher(this),this.config=a,this.ac=this.config.getAudioContext(),this.fadeMaker=new Fades,this.fadeMaker.init(this.ac.sampleRate),this.fadeGain=void 0,this.destination=this.ac.destination},AudioPlayout.prototype.getBuffer=function(){return this.buffer},AudioPlayout.prototype.applyFades=function(a,b,c){var d,e,f,g,h,i;this.fadeGain=this.ac.createGain();for(d in a)e=a[d],b>=e.end||(b<=e.start?(h=c+(e.start-b),i=e.end-e.start):b>e.start&&b<e.end&&(h=c-(b-e.start),i=e.end-e.start),g={start:h,duration:i},a.hasOwnProperty(d)&&(f=this.fadeMaker["create"+e.type],f.call(this.fadeMaker,this.fadeGain.gain,e.shape,g)))},AudioPlayout.prototype.loadData=function(a,b){var c=this;this.ac.decodeAudioData(a,function(a){c.buffer=a,b(a)},function(a){console.log("err(decodeAudioData): "+a),b(null,a)})},AudioPlayout.prototype.isPlaying=function(){return void 0!==this.source},AudioPlayout.prototype.getDuration=function(){return this.buffer.duration},AudioPlayout.prototype.onSourceEnded=function(a){this.source.disconnect(),this.source=void 0,this.fadeGain.disconnect(),this.fadeGain=void 0},AudioPlayout.prototype.setUpSource=function(){this.source=this.ac.createBufferSource(),this.source.buffer=this.buffer,this.source.onended=this.onSourceEnded.bind(this),this.source.connect(this.fadeGain),this.fadeGain.connect(this.destination)},AudioPlayout.prototype.play=function(a,b,c){return this.buffer?(this.setUpSource(),void this.source.start(a||0,b,c)):void console.error("no buffer to play")},AudioPlayout.prototype.stop=function(a){this.source&&this.source.stop(a||0)};var TrackEditor=function(){};TrackEditor.prototype.classes={cursor:["state-select"],select:["state-select"],fadein:["state-select"],fadeout:["state-select"],shift:["state-shift"],active:["active"],disabled:["disabled"]},TrackEditor.prototype.events={cursor:{mousedown:"selectCursorPos"},select:{mousedown:"selectStart"},fadein:{mousedown:"selectFadeIn"},fadeout:{mousedown:"selectFadeOut"},shift:{mousedown:"timeShift"}},TrackEditor.prototype.setConfig=function(a){this.config=a},TrackEditor.prototype.setLeftOffset=function(a){this.leftOffset=a,this.drawer.setPixelOffset(a/this.resolution)},TrackEditor.prototype.init=function(a,b,c,d,e,f){var g={cursor:!0,fadein:!0,fadeout:!0,select:!0,shift:!0};if(Object.keys(g).forEach(function(a){g[a]=a in f?f[a]:g[a]}),this.enabledStates=g,makePublisher(this),this.container=document.createElement("div"),this.drawer=new WaveformDrawer,this.drawer.init(this.container,this.config),this.playout=new AudioPlayout,this.playout.init(this.config),this.sampleRate=this.config.getSampleRate(),this.resolution=this.config.getResolution(),this.startTime=b||0,this.endTime=c||0,this.setLeftOffset(this.secondsToSamples(this.startTime)),this.prevStateEvents={},this.setState(this.config.getState()),this.fades={},void 0!==d&&d.length>0)for(var h=0;h<d.length;h++)this.fades[this.getFadeId()]=d[h];return void 0!==e.cuein&&this.setCuePoints(this.secondsToSamples(e.cuein),this.secondsToSamples(e.cueout)),this.active=!1,this.selectedArea=void 0,this.container.classList.add("channel-wrapper"),this.drawer.drawLoading(),this.container},TrackEditor.prototype.getFadeId=function(){var a=""+Math.random();return a.replace(".","")},TrackEditor.prototype.getBuffer=function(){return this.playout.getBuffer()},TrackEditor.prototype.loadTrack=function(a){var b;return b=this.init(a.src,a.start,a.end,a.fades,{cuein:a.cuein,cueout:a.cueout},a.states||{}),void 0!==a.selected&&(this.selectedArea={start:this.secondsToSamples(a.selected.start),end:this.secondsToSamples(a.selected.end)}),this.loadBuffer(a.src),b},TrackEditor.prototype.loadBuffer=function(a){var b=this,c=new XMLHttpRequest;c.open("GET",a,!0),c.responseType="arraybuffer",c.addEventListener("progress",function(a){var c;a.lengthComputable&&(c=a.loaded/a.total*100,b.drawer.updateLoader(c))},!1),c.addEventListener("load",function(c){b.src=a,b.drawer.setLoaderState("decoding"),b.playout.loadData(c.target.response,b.onTrackLoad.bind(b))},!1),c.send()},TrackEditor.prototype.drawTrack=function(a){this.drawer.drawBuffer(a,this.cues),this.drawer.drawFades(this.fades)},TrackEditor.prototype.onTrackLoad=function(a,b){var c,d,e;return void 0!==b?(this.container.innerHTML="",this.container.classList.add("error"),void this.fire("unregister")):(void 0===this.cues?this.setCuePoints(0,a.length-1):this.cues.cueout>a.length-1&&(this.cues.cueout=a.length-1),void 0!==this.width&&(c=Math.ceil(a.length/this.width),this.config.setResolution(c),this.resolution=c),this.drawTrack(a),void(void 0!==this.selectedArea&&(d=this.samplesToSeconds(this.selectedArea.start),e=this.samplesToSeconds(this.selectedArea.end),this.config.setCursorPos(d),this.notifySelectUpdate(d,e))))},TrackEditor.prototype.samplesToSeconds=function(a){return a/this.sampleRate},TrackEditor.prototype.secondsToSamples=function(a){return Math.ceil(a*this.sampleRate)},TrackEditor.prototype.samplesToPixels=function(a){return~~(a/this.resolution)},TrackEditor.prototype.pixelsToSamples=function(a){return~~(a*this.resolution)},TrackEditor.prototype.pixelsToSeconds=function(a){return a*this.resolution/this.sampleRate},TrackEditor.prototype.secondsToPixels=function(a){return~~(a*this.sampleRate/this.resolution)},TrackEditor.prototype.activate=function(){this.active=!0,this.container.classList.add("active")},TrackEditor.prototype.deactivate=function(){this.active=!1,this.selectedArea=void 0,this.container.classList.remove("active"),this.drawer.clear()},TrackEditor.prototype.notifySelectUpdate=function(a,b){this.fire("changecursor",{start:a,end:b,editor:this})},TrackEditor.prototype.getSelectedPlayTime=function(){var a=this.selectedArea,b=this.leftOffset,c=this.samplesToSeconds(b+a.start),d=this.samplesToSeconds(b+a.end);return{startTime:c,endTime:d}},TrackEditor.prototype.getSelectedArea=function(){return this.selectedArea},TrackEditor.prototype.adjustSelectedArea=function(a,b){var c=this.getBuffer(),d=this.cues;return(void 0===a||0>a)&&(a=0),void 0===b&&(b=d.cueout-d.cuein),b>c.length-1&&(b=c.length-1),{start:a,end:b}},TrackEditor.prototype.setSelectedArea=function(a,b,c){{var d,e,f,g,h,i;this.getBuffer()}c&&b-a===0&&void 0!==this.prevSelectedArea?(f=this.samplesToPixels(this.prevSelectedArea.start),g=this.samplesToPixels(this.prevSelectedArea.end),f>a?(d=a,e=g):b>g?(d=f,e=b):g-a>a-f?(d=a,e=g):(d=f,e=b)):(d=a,e=b),h=void 0===d?void 0:this.pixelsToSamples(d),i=void 0===e?void 0:this.pixelsToSamples(e),this.prevSelectedArea=this.selectedArea,this.selectedArea=this.adjustSelectedArea(h,i),this.showSelection()},TrackEditor.prototype.activateAudioSelection=function(){this.fire("activateSelection")},TrackEditor.prototype.deactivateAudioSelection=function(){this.fire("deactivateSelection")},TrackEditor.prototype.findLayerOffset=function(a){var b,c=0;return"CANVAS"!==a.target.tagName?c=-1:(b=a.target.parentNode,b.classList.contains("playlist-fade")&&(c=b.offsetLeft)),c},TrackEditor.prototype.timeShift=function(a){a.preventDefault();var b,c=this.container,d=this,e=a.pageX,f=0,g=0,h=d.leftOffset/d.resolution;c.onmousemove=function(a){a.preventDefault();var b=a.pageX;f=b-e,g=h+f,d.setLeftOffset(d.pixelsToSamples(g))},b=function(a){a.preventDefault();var b=d.pixelsToSeconds(f);c.onmousemove=c.onmouseup=c.onmouseleave=null,d.setLeftOffset(d.pixelsToSamples(g)),d.startTime=d.startTime+b,d.endTime=d.endTime+b},c.onmouseup=c.onmouseleave=b},TrackEditor.prototype.selectStart=function(a){a.preventDefault();var b,c,d,e=this.container,f=this,g=a.layerX||a.offsetX,h=a.layerX||a.offsetX,i=this.leftOffset;c=this.findLayerOffset(a),0>c||(g+=c,h+=c,f.setSelectedArea(g,g),b=f.samplesToSeconds(i+f.selectedArea.start),f.notifySelectUpdate(b,b),e.onmousemove=function(a){a.preventDefault();{var b,d,e,j,k=c+(a.layerX||a.offsetX);Math.min(h,k,g),Math.max(h,k,g)}k>g?(b=g,d=k):(b=k,d=g),e=f.samplesToSeconds(i+f.selectedArea.start),j=f.samplesToSeconds(i+f.selectedArea.end),f.setSelectedArea(b,d),f.notifySelectUpdate(e,j),h=k},d=function(a){a.preventDefault();var b,d,h,j,k=c+(a.layerX||a.offsetX);b=Math.min(g,k),d=Math.max(g,k),f.setSelectedArea(b,d,a.shiftKey),b=f.samplesToPixels(i+f.selectedArea.start),d=f.samplesToPixels(i+f.selectedArea.end),e.onmousemove=e.onmouseup=e.onmouseleave=null,Math.abs(b-d)?f.activateAudioSelection():f.deactivateAudioSelection(),h=f.samplesToSeconds(i+f.selectedArea.start),j=f.samplesToSeconds(i+f.selectedArea.end),f.config.setCursorPos(h),f.notifySelectUpdate(h,j)},e.onmouseup=e.onmouseleave=d)},TrackEditor.prototype.selectCursorPos=function(a){var b,c,d,e=this,f=a.layerX||a.offsetX,g=this.leftOffset;d=this.findLayerOffset(a),0>d||(f+=d,e.setSelectedArea(f,f),b=e.samplesToSeconds(g+e.selectedArea.start),c=e.samplesToSeconds(g+e.selectedArea.end),e.config.setCursorPos(b),e.notifySelectUpdate(b,c),e.deactivateAudioSelection())},TrackEditor.prototype.selectFadeIn=function(a){var b,c=a.layerX||a.offsetX,d="FadeIn",e=this.config.getFadeType();b=this.findLayerOffset(a),0>b||(c+=b,this.setSelectedArea(void 0,c),this.removeFadeType(d),this.createFade(d,e))},TrackEditor.prototype.selectFadeOut=function(a){var b,c=a.layerX||a.offsetX,d="FadeOut",e=this.config.getFadeType();b=this.findLayerOffset(a),0>b||(c+=b,this.setSelectedArea(c,void 0),this.removeFadeType(d),this.createFade(d,e))},TrackEditor.prototype.saveFade=function(a,b,c,d,e){return this.fades[a]={type:b,shape:c,start:d,end:e},a},TrackEditor.prototype.removeFade=function(a){delete this.fades[a],this.drawer.removeFade(a)},TrackEditor.prototype.removeFadeType=function(a){var b,c,d=this.fades;for(b in d)c=d[b],c.type===a&&this.removeFade(b)},TrackEditor.prototype.setCuePoints=function(a,b){var c=this.cues?this.cues.cuein:0;this.cues={cuein:c+a,cueout:c+b},this.duration=(b-a)/this.sampleRate,this.endTime=this.duration+this.startTime},TrackEditor.prototype.trim=function(a,b){this.setCuePoints(a,b+1),this.resetCursor(),this.fades={},this.drawTrack(this.getBuffer())},TrackEditor.prototype.onTrackEdit=function(a){var b=a.type,c="on"+b.charAt(0).toUpperCase()+b.slice(1);this.active===!0&&this[c].call(this,a.args)},TrackEditor.prototype.createFade=function(a,b){var c=this.selectedArea,d=this.samplesToPixels(c.start),e=this.samplesToPixels(c.end),f=this.samplesToSeconds(c.start),g=this.samplesToSeconds(c.end),h=this.getFadeId();this.resetCursor(),this.saveFade(h,a,b,f,g),this.drawer.drawFade(h,a,b,d,e)},TrackEditor.prototype.onCreateFade=function(a){this.createFade(a.type,a.shape),this.deactivateAudioSelection()},TrackEditor.prototype.onTrimAudio=function(){var a=this.getSelectedArea();this.trim(a.start,a.end),this.deactivateAudioSelection()},TrackEditor.prototype.setState=function(a){var b,c,d,e,f,g=this,h=this.events[a],i=this.classes[a],j=this.classes.disabled,k=this.enabledStates,l=this.container,m=this.currentState,n=this.prevStateEvents;if(m)if(b=this.classes[m],k[m]===!0){for(d in n)l.removeEventListener(d,n[d]);for(this.prevStateEvents={},e=0,f=b.length;f>e;e++)l.classList.remove(b[e])}else for(e=0,f=j.length;f>e;e++)l.classList.remove(j[e]);if(k[a]===!0){for(d in h)c=g[h[d]].bind(g),this.prevStateEvents[d]=c,l.addEventListener(d,c);for(e=0,f=i.length;f>e;e++)l.classList.add(i[e])}else for(e=0,f=j.length;f>e;e++)l.classList.add(j[e]);this.currentState=a},TrackEditor.prototype.onResolutionChange=function(a){var b=this.selectedArea;this.resolution=a,this.drawTrack(this.getBuffer()),this.drawer.setPixelOffset(this.leftOffset/a),this.active===!0&&void 0!==this.selectedArea&&this.drawer.drawHighlight(this.samplesToPixels(b.start),this.samplesToPixels(b.end))},TrackEditor.prototype.isPlaying=function(){return this.playout.isPlaying()},TrackEditor.prototype.schedulePlay=function(a,b,c){var d,e,f,g=a,h=c?c-b:void 0,i=this.cues.cuein/this.sampleRate;this.endTime<=b||h&&b+h<this.startTime||(this.startTime>=b?(d=0,g=g+this.startTime-b,c?(h-=this.startTime-b,e=Math.min(h,this.duration)):e=this.duration):(d=b-this.startTime,e=c?Math.min(h,this.duration-d):this.duration-d),d+=i,f=b-this.startTime,this.playout.applyFades(this.fades,f,a),this.playout.play(g,d,e))},TrackEditor.prototype.scheduleStop=function(a){this.playout.stop(a)},TrackEditor.prototype.resetCursor=function(){this.selectedArea=void 0,this.config.setCursorPos(0),this.drawer.clear(),this.notifySelectUpdate(0,0)},TrackEditor.prototype.showProgress=function(a){this.drawer.updateProgress(a)},TrackEditor.prototype.showSelection=function(){var a,b;a=this.samplesToPixels(this.selectedArea.start),b=this.samplesToPixels(this.selectedArea.end),this.drawer.drawHighlight(a,b)},TrackEditor.prototype.getTrackDetails=function(){var a,b,c=this.cues,d=[];for(b in this.fades)d.push(this.fades[b]);return a={start:this.startTime,end:this.endTime,fades:d,src:this.src,cuein:this.samplesToSeconds(c.cuein),cueout:this.samplesToSeconds(c.cueout)}};var TimeScale=function(){};TimeScale.prototype.init=function(a){function b(){g.width=g.container.clientWidth,g.height=g.container.clientHeight,d.setAttribute("width",g.width),d.setAttribute("height",g.height),g.drawScale()}function c(){clearTimeout(f),f=setTimeout(b,100)}var d,e,f,g=this;makePublisher(this),e=document.getElementsByClassName("playlist-time-scale")[0],void 0!==e&&(d=document.createElement("canvas"),this.canv=d,this.context=d.getContext("2d"),this.config=a,this.container=e,this.width=this.container.clientWidth,this.height=this.container.clientHeight,d.setAttribute("width",this.width),d.setAttribute("height",this.height),this.times=[],this.prevScrollPos=0,TimeScale.prototype.onResize=c,this.drawScale())},TimeScale.prototype.formatTime=function(a){var b,c,d;return d=a%60,c=(a-d)/60,10>d&&(d="0"+d),b=c+":"+d},TimeScale.prototype.clear=function(){this.container.innerHTML="",this.context.clearRect(0,0,this.width,this.height)},TimeScale.prototype.drawScale=function(a){var b,c,d,e,f,g,h,i,j,k=this.context,l=this.canv,m=this.config.getColorScheme(),n=this.config.getResolution(),o=this.config.getSampleRate(),p=o/n,q=a||0,r=0,s=this.container,t=this.width,u=this.height,v=document.createDocumentFragment();for(this.clear(),v.appendChild(l),k.fillStyle=m.timeColor,d=t+q,c=0;d>c;c+=p)e=~~c,b=e-q,e>=q&&(r%30===0?(h=this.formatTime(r),g=document.createTextNode(h),f=document.createElement("div"),f.style.left=b+"px",f.appendChild(g),v.appendChild(f),j=10,i=u-j):r%5===0?(j=5,i=u-j):(j=2,i=u-j),k.fillRect(b,i,1,j)),r++;s.appendChild(v)},TimeScale.prototype.onTrackScroll=function(){var a=this.config.getTrackScroll(),b=a.left;b!==this.prevScrollPos&&(this.prevScrollPos=b,this.drawScale(b))},TimeScale.prototype.onResolutionChange=function(){var a=this.config.getTrackScroll(),b=a.left;this.drawScale(b)};var AudioControls=function(){};AudioControls.prototype.groups={"audio-select":["btns_audio_tools"]},AudioControls.prototype.classes={"btn-state-active":"btn btn-mini active","btn-state-default":"btn btn-mini",disabled:"disabled",active:"active"},AudioControls.prototype.events={"btn-rewind":{click:"rewindAudio"},"btn-fast-forward":{click:"fastForwardAudio"},"btn-play":{click:"playAudio"},"btn-pause":{click:"pauseAudio"},"btn-stop":{click:"stopAudio"},"btn-cursor":{click:"changeState"},"btn-select":{click:"changeState"},"btn-shift":{click:"changeState"},"btn-fadein":{click:"changeState"},"btn-fadeout":{click:"changeState"},"btn-save":{click:"save"},"btn-open":{click:"open"},"btn-trim-audio":{click:"trimAudio"},"time-format":{change:"changeTimeFormat"},"audio-pos":{},"audio-start":{blur:"validateCueIn"},"audio-end":{blur:"validateCueOut"},"btn-logarithmic":{click:"changeDefaultFade"},"btn-linear":{click:"changeDefaultFade"},"btn-exponential":{click:"changeDefaultFade"},"btn-sCurve":{click:"changeDefaultFade"},"btn-zoom-in":{click:"zoomIn"},"btn-zoom-out":{click:"zoomOut"}},AudioControls.prototype.validateCue=function(a){var b,c,d;return b={seconds:/^\d+$/,thousandths:/^\d+\.\d{3}$/,"hh:mm:ss":/^[0-9]{2,}:[0-5][0-9]:[0-5][0-9]$/,"hh:mm:ss.u":/^[0-9]{2,}:[0-5][0-9]:[0-5][0-9]\.\d{1}$/,"hh:mm:ss.uu":/^[0-9]{2,}:[0-5][0-9]:[0-5][0-9]\.\d{2}$/,"hh:mm:ss.uuu":/^[0-9]{2,}:[0-5][0-9]:[0-5][0-9]\.\d{3}$/},c=b[this.timeFormat],d=c.test(a)},AudioControls.prototype.cueToSeconds=function(a){function b(a){var b,c=a.split(":"),d=3600*parseInt(c[0],10),e=60*parseInt(c[1],10),f=parseFloat(c[2]);return b=d+e+f}var c,d,e;return c={seconds:function(a){return parseInt(a,10)},thousandths:function(a){return parseFloat(a)},"hh:mm:ss":function(a){return b(a)},"hh:mm:ss.u":function(a){return b(a)},"hh:mm:ss.uu":function(a){return b(a)},"hh:mm:ss.uuu":function(a){return b(a)}},d=c[this.timeFormat],e=d(a)},AudioControls.prototype.cueFormatters=function(a){function b(a,b){var c,d,e,f;return c=parseInt(a/3600,10)%24,d=parseInt(a/60,10)%60,e=a%60,e=e.toFixed(b),f=(10>c?"0"+c:c)+":"+(10>d?"0"+d:d)+":"+(10>e?"0"+e:e)}var c={seconds:function(a){return a.toFixed(0)},thousandths:function(a){return a.toFixed(3)},"hh:mm:ss":function(a){return b(a,0)},"hh:mm:ss.u":function(a){return b(a,1)},"hh:mm:ss.uu":function(a){return b(a,2)},"hh:mm:ss.uuu":function(a){return b(a,3)}};return c[a]},AudioControls.prototype.init=function(a){var b,c,d,e,f,g,h,i,j=this,k=this.events;makePublisher(this),this.ctrls={},this.config=a,g=this.config.getContainer(),f=this.config.getState(),h=this.config.getFadeType(),["btn-"+f,"btn-"+h].forEach(function(a){i=document.getElementsByClassName(a)[0],i&&this.activateButton(i)},this);for(b in k){d=g.getElementsByClassName(b)[0],this.ctrls[b]=d;for(c in k[b])d&&(e=j[k[b][c]].bind(j),d.addEventListener(c,e))}this.ctrls["time-format"]&&(this.ctrls["time-format"].value=this.config.getTimeFormat()),this.timeFormat=this.config.getTimeFormat(),this.currentSelectionValues=void 0,this.onCursorSelection({start:0,end:0})},AudioControls.prototype.changeDefaultFade=function(a){var b=a.currentTarget,c=b.parentElement.getElementsByClassName("active")[0],d=b.dataset.fade;this.deactivateButton(c),this.activateButton(b),this.config.setFadeType(d)},AudioControls.prototype.changeTimeFormat=function(a){var b,c,d,e=a.target.value;e=void 0!==this.cueFormatters(e)?e:"hh:mm:ss",this.config.setTimeFormat(e),this.timeFormat=e,void 0!==this.currentSelectionValues&&(b=this.cueFormatters(e),c=this.currentSelectionValues.start,d=this.currentSelectionValues.end,this.ctrls["audio-start"]&&(this.ctrls["audio-start"].value=b(c)),this.ctrls["audio-end"]&&(this.ctrls["audio-end"].value=b(d)))},AudioControls.prototype.zoomIn=function(){var a=.75*this.config.getResolution(),b=this.config.getMinResolution();a=b>a?b:a,a>b&&this.zoom(a)},AudioControls.prototype.zoomOut=function(){var a=this.config.getResolution()*(4/3),b=this.config.getMaxResolution();a=a>b?b:a,b>a&&this.zoom(a)},AudioControls.prototype.zoom=function(a){this.config.setResolution(a),this.fire("changeresolution",a)},AudioControls.prototype.validateCueIn=function(a){var b,c,d=a.target.value;return this.validateCue(d)&&(b=this.currentSelectionValues.end,c=this.cueToSeconds(d),b>=c)?(this.notifySelectionUpdate(c,b),void(this.currentSelectionValues.start=c)):void(a.target.value=this.cueFormatters(this.timeFormat)(this.currentSelectionValues.start))},AudioControls.prototype.validateCueOut=function(a){var b,c,d=a.target.value;return this.validateCue(d)&&(b=this.currentSelectionValues.start,c=this.cueToSeconds(d),c>=b)?(this.notifySelectionUpdate(b,c),void(this.currentSelectionValues.end=c)):void(a.target.value=this.cueFormatters(this.timeFormat)(this.currentSelectionValues.end))},AudioControls.prototype.activateButtonGroup=function(a){var b,c,d,e=document.getElementById(a),f=this.classes;if(null!==e)for(b=e.children,c=0,d=b.length;d>c;c++)b[c].classList.remove(f.disabled)},AudioControls.prototype.deactivateButtonGroup=function(a){var b,c,d,e=document.getElementById(a),f=this.classes;if(null!==e)for(b=e.children,c=0,d=b.length;d>c;c++)b[c].classList.add(f.disabled);

},AudioControls.prototype.activateAudioSelection=function(){var a,b,c=this.groups["audio-select"];for(a=0,b=c.length;b>a;a++)this.activateButtonGroup(c[a])},AudioControls.prototype.deactivateAudioSelection=function(){var a,b,c=this.groups["audio-select"];for(a=0,b=c.length;b>a;a++)this.deactivateButtonGroup(c[a])},AudioControls.prototype.save=function(){this.fire("playlistsave",this)},AudioControls.prototype.open=function(){this.fire("playlistrestore",this)},AudioControls.prototype.rewindAudio=function(){this.fire("rewindaudio",this)},AudioControls.prototype.fastForwardAudio=function(){this.fire("fastforwardaudio",this)},AudioControls.prototype.playAudio=function(){this.fire("playaudio",this)},AudioControls.prototype.pauseAudio=function(){this.fire("pauseaudio",this)},AudioControls.prototype.stopAudio=function(){this.fire("stopaudio",this)},AudioControls.prototype.activateButton=function(a){a&&a.classList.add(this.classes.active)},AudioControls.prototype.deactivateButton=function(a){a&&a.classList.remove(this.classes.active)},AudioControls.prototype.enableButton=function(a){a&&a.classList.remove(this.classes.disabled)},AudioControls.prototype.disableButton=function(a){a&&a.classList.add(this.classes.disabled)},AudioControls.prototype.changeState=function(a){var b=a.currentTarget,c=b.parentElement.getElementsByClassName("active")[0],d=b.dataset.state;this.deactivateButton(c),this.activateButton(b),this.config.setState(d),this.fire("changestate",this)},AudioControls.prototype.trimAudio=function(a){var b,c=a.target,d=this.classes;b=c.classList.contains(d.disabled),b||this.fire("trackedit",{type:"trimAudio"})},AudioControls.prototype.createFade=function(a){var b,c=a.target,d=c.dataset.shape,e=c.dataset.type,f=this.classes;b=c.classList.contains(f.disabled),b||this.fire("trackedit",{type:"createFade",args:{type:e,shape:d}})},AudioControls.prototype.onAudioSelection=function(){this.activateAudioSelection()},AudioControls.prototype.onAudioDeselection=function(){this.deactivateAudioSelection()},AudioControls.prototype.notifySelectionUpdate=function(a,b){this.fire("changeselection",{start:a,end:b})},AudioControls.prototype.onCursorSelection=function(a){var b=this.cueFormatters(this.timeFormat)(a.start),c=this.cueFormatters(this.timeFormat)(a.end),d=this.cueToSeconds(b),e=this.cueToSeconds(c);this.currentSelectionValues={start:d,end:e},this.ctrls["audio-start"]&&(this.ctrls["audio-start"].value=b),this.ctrls["audio-end"]&&(this.ctrls["audio-end"].value=c)},AudioControls.prototype.onAudioUpdate=function(a){this.ctrls["audio-pos"]&&(this.ctrls["audio-pos"].innerHTML=this.cueFormatters(this.timeFormat)(a.seconds))};var PlaylistEditor=function(){};PlaylistEditor.prototype.setConfig=function(a){this.config=a},PlaylistEditor.prototype.init=function(a){var b,c,d,e,f,g,h=this,i=this.config.getContainer(),j=i.getElementsByClassName("playlist-tracks")[0],k=document.createDocumentFragment();for(makePublisher(this),this.storage=new Storage,this.trackContainer=j,this.trackEditors=[],g=new AudioControls,g.init(this.config),this.config.isTimeScaleEnabled()&&(f=new TimeScale,f.init(this.config),g.on("changeresolution","onResolutionChange",f),this.on("trackscroll","onTrackScroll",f)),this.timeScale=f,b=0,c=a.length;c>b;b++)d=new TrackEditor,d.setConfig(this.config),e=d.loadTrack(a[b]),this.trackEditors.push(d),k.appendChild(e),g.on("trackedit","onTrackEdit",d),g.on("changeresolution","onResolutionChange",d),d.on("activateSelection","onAudioSelection",g),d.on("deactivateSelection","onAudioDeselection",g),d.on("changecursor","onCursorSelection",g),d.on("changecursor","onSelectUpdate",this),d.on("unregister",function(){var a=this;g.remove("trackedit","onTrackEdit",a),g.remove("changeresolution","onResolutionChange",a),h.removeTrack(a)}.bind(d));this.trackContainer.innerHTML="",this.trackContainer.appendChild(k),this.trackContainer.onscroll=this.onTrackScroll.bind(this),this.sampleRate=this.config.getSampleRate(),this.scrollTimeout=!1,this.animationRequest,this.animationCallback=this.updateEditor.bind(this),this.on("playbackcursor","onAudioUpdate",g),g.on("playlistsave","save",this),g.on("playlistrestore","restore",this),g.on("rewindaudio","rewind",this),g.on("fastforwardaudio","fastForward",this),g.on("playaudio","play",this),g.on("pauseaudio","pause",this),g.on("stopaudio","stop",this),g.on("trimaudio","onTrimAudio",this),g.on("changestate","onStateChange",this),g.on("changeselection","onSelectionChange",this)},PlaylistEditor.prototype.removeTrack=function(a){var b,c,d,e=this.trackEditors;for(b=0,c=e.length;c>b;b++)if(d=e[b],d===a)return void e.splice(b,1)},PlaylistEditor.prototype.resize=function(){this.timeScale.onResize()},PlaylistEditor.prototype.onTrimAudio=function(){var a=this.activeTrack,b=a.getSelectedArea();void 0!==b&&a.trim(b.start,b.end)},PlaylistEditor.prototype.onSelectionChange=function(a){if(void 0!==this.activeTrack){var b=(this.config.getResolution(),this.activeTrack),c=~~(b.secondsToPixels(a.start)-b.samplesToPixels(b.leftOffset)),d=~~(b.secondsToPixels(a.end)-b.samplesToPixels(b.leftOffset));this.config.setCursorPos(a.start),b.setSelectedArea(c,d)}},PlaylistEditor.prototype.onStateChange=function(){var a,b,c=this.trackEditors,d=this.config.getState();for(a=0,b=c.length;b>a;a++)c[a].deactivate(),c[a].setState(d)},PlaylistEditor.prototype.onTrackScroll=function(){var a=this;a.scrollTimeout||(a.scrollTimeout=setTimeout(function(){a.config.setTrackScroll(a.trackContainer.scrollLeft,a.trackContainer.scrollTop),a.fire("trackscroll"),a.scrollTimeout=!1},25))},PlaylistEditor.prototype.activateTrack=function(a){var b,c,d,e=this.trackEditors;for(b=0,c=e.length;c>b;b++)d=e[b],d===a?(d.activate(),this.activeTrack=a):d.deactivate()},PlaylistEditor.prototype.onSelectUpdate=function(a){this.activateTrack(a.editor)},PlaylistEditor.prototype.resetCursor=function(){this.config.setCursorPos(0)},PlaylistEditor.prototype.onCursorSelection=function(a){this.activateTrack(a.editor)},PlaylistEditor.prototype.rewind=function(){void 0!==this.activeTrack?this.activeTrack.resetCursor():this.resetCursor(),this.stop(),this.trackContainer.scrollLeft=0,this.config.setTrackScroll(0),this.fire("trackscroll")},PlaylistEditor.prototype.fastForward=function(){var a=this.trackContainer.scrollWidth,b=this.trackContainer.offsetWidth,c=Math.max(a-b,0);void 0!==this.activeTrack&&this.activeTrack.resetCursor(),this.stop(),this.trackContainer.scrollLeft=c,this.config.setTrackScroll(c),this.fire("trackscroll")},PlaylistEditor.prototype.getSelected=function(){var a;return this.activeTrack&&(a=this.activeTrack.selectedArea,void 0!==a&&a.end>a.start)?this.activeTrack.getSelectedPlayTime():void 0},PlaylistEditor.prototype.isPlaying=function(){var a,b,c=this.trackEditors,d=!1;for(a=0,b=c.length;b>a;a++)d=d||c[a].isPlaying();return d},PlaylistEditor.prototype.play=function(){var a,b,c,d=this.trackEditors,e=this.config.getCurrentTime(),f=this.config.getCursorPos(),g=this.getSelected();for(void 0!==g&&(f=g.startTime,c=g.endTime),this.pausedAt&&(f=this.pausedAt),a=0,b=d.length;b>a;a++)d[a].schedulePlay(e,f,c);this.lastPlay=e,this.animationRequest=window.requestAnimationFrame(this.animationCallback)},PlaylistEditor.prototype.pause=function(){var a,b,c=this.trackEditors,d=this.config.getCurrentTime(),e=this.config.getCursorPos();for(this.pausedAt&&(e=this.pausedAt),this.pausedAt=d-this.lastPlay+e,window.cancelAnimationFrame(this.animationRequest),a=0,b=c.length;b>a;a++)c[a].scheduleStop(d)},PlaylistEditor.prototype.stop=function(){var a,b,c=this.trackEditors,d=this.config.getCurrentTime();for(this.pausedAt=void 0,window.cancelAnimationFrame(this.animationRequest),a=0,b=c.length;b>a;a++)c[a].scheduleStop(d),c[a].showProgress(0)},PlaylistEditor.prototype.updateEditor=function(){var a,b,c,d,e=this.trackEditors,f=this.config.getCurrentTime(),g=f-this.lastPlay,h=this.config.getResolution(),i=this.config.getCursorPos();if(this.pausedAt&&(i=this.pausedAt),this.isPlaying()){if(g){for(d=i+g,c=Math.ceil(d*this.sampleRate/h),a=0,b=e.length;b>a;a++)e[a].showProgress(c);this.fire("playbackcursor",{seconds:d,pixels:c})}this.animationRequest=window.requestAnimationFrame(this.animationCallback)}else{for(a=0,b=e.length;b>a;a++)e[a].showProgress(0);window.cancelAnimationFrame(this.animationRequest)}},PlaylistEditor.prototype.getJson=function(){var a,b,c,d=this.trackEditors,e=[];for(a=0,b=d.length;b>a;a++)e.push(d[a].getTrackDetails());return c=JSON.stringify(e),e},PlaylistEditor.prototype.save=function(){var a,b,c=this.trackEditors,d=[];for(a=0,b=c.length;b>a;a++)d.push(c[a].getTrackDetails());this.storage.save("test",d)},PlaylistEditor.prototype.restore=function(){var a;a=this.storage.restore("test"),this.trackContainer.innerHTML="",this.init(a)};